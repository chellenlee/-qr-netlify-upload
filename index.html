<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>QR通過記録アプリ</title>
</head>
<body>
  <h1>QR通過記録アプリ</h1>
  <input type="file" id="fileInput">
  <input type="text" id="staffInput" placeholder="担当者名">
  <button onclick="uploadFile()">アップロード</button>
  <pre id="result"></pre>

<script>
function uploadFile() {
  const fileInput = document.getElementById('fileInput');
  const staffInput = document.getElementById('staffInput');
  const result = document.getElementById('result');

  if (!fileInput.files.length || !staffInput.value) {
    result.textContent = "ファイルと担当者名を入力してください。";
    return;
  }

  const reader = new FileReader();
  reader.onload = function () {
    const base64 = reader.result.split(',')[1];
    const payload = {
      filename: fileInput.files[0].name,
      staff: staffInput.value,
      content: base64
    };

    fetch('/.netlify/functions/upload', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    })
    .then(res => res.json())
    .then(data => result.textContent = JSON.stringify(data, null, 2))
    .catch(err => result.textContent = "エラー: " + err.message);
  };

  reader.readAsDataURL(fileInput.files[0]);
}
</script>
</body>
</html>
